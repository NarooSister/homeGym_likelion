<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .outer-card {
            background-color: #f8f9fa; /* 밖의 카드 배경색 */
            border: none;
        }

        .review-stars {
            color: #f1c40f; /* 별점 색상 */
            margin-bottom: 10px;
        }

        .outer-cardTwo {
            background-color: #f8f9fa; /* 밖의 카드 배경색 */
            border: none;
            width: 90%;
        }

        .inner-card {
            background-color: #ffffff; /* 안의 카드 배경색 */
            border-radius: 20px;
            border: 2px solid rgba(0, 0, 0, 0.125);
        }

        .inner-cardTwo {
            display: flex;
            flex-direction: row;
        }

        .card-title {
            font-size: 1.5rem; /* 제목 크기 */
            margin-bottom: 0.5rem;
        }

        .card-description {
            font-size: 1rem; /* 설명 크기 */
            color: #6c757d; /* 설명 색상 */
        }

        .card-count {
            font-size: 1.2rem; /* 회차 크기 */
            font-weight: bold; /* 회차 굵기 */
        }

        .card-countTwo {
            font-size: 1.0rem; /* 회차 크기 */
            font-weight: bold; /* 회차 굵기 */
        }

        .card-max-count {
            font-size: 1.0rem; /* 총 회차 크기 */
            font-weight: bold; /* 회차 굵기 */
            color: #6c757d; /* 총 회차 색상 */
        }

        .card.inner-card a {
            text-decoration: none;
        }

        .heart-icon {
            font-size: 2rem; /* 아이콘 크기 */
            color: red; /* 아이콘 색상 */
        }

        .heart-link {
            position: absolute; /* 절대 위치 */
            top: 50%; /* 중앙 정렬을 위해 상단 50%로 설정 */
            right: 0; /* 오른쪽 정렬 */
            transform: translateY(-50%); /* 수직으로 중앙 정렬 */
            margin-right: 30px; /* 오른쪽으로부터 30px 간격 */
        }

        .card-body.position-relative.d-flex.align-items-center img.rounded-circle {
            border-radius: 50%; /* 원형 모양으로 만듭니다. */
        }

        /* 이름과 성별을 나란히 정렬하는 CSS */
        .card-body.position-relative.d-flex.align-items-center div {
            margin-right: 30px; /* 이름과 성별 사이의 간격 조절 */
            display: flex; /* 내부 요소들을 수평으로 정렬하기 위해 flex로 설정 */
            align-items: center; /* 내부 요소들을 수직으로 중앙 정렬 */
        }

        .card-body.position-relative.d-flex.align-items-center p {
            margin-right: 10px; /* 이름과 성별 사이의 간격 조절 */
        }

        /*검색 바에서 사용*/
        select {
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
        }

        select:focus {
            outline: none;
        }

    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center mb-4">navbar 위치</h1>
</div>
<div class="container mt-5">
    <h1 class="text-center mb-4"><b>방구석 운동왕</b></h1>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card outer-card">
                <div class="card-body">
                    <h2 class="card-title" style="text-align: center"><b>운동 전문가 찾기</b></h2>
                    <hr>

                    <!-- 주소 등록 섹션 추가 -->
                    <div class="card mb-3 mt-3">
                        <div class="card-header">정보 설정하기</div>
                        <div class="card-body">
                            <form id="filterForm">
                                <div class="form-row">
                                    <div class="col-auto">
                                        <label for="siDoSelect" class="form-label"></label>
                                        <select id="siDoSelect" name="siDo" class="form-select mr-2">
                                            <option value="">시도 선택</option>
                                            <!-- SiDo options will be dynamically populated here -->
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <label for="siGunGuSelect" class="form-label"></label>
                                        <select id="siGunGuSelect" name="siGunGu" class="form-select mr-2">
                                            <option value="">시군구 선택</option>
                                            <!-- SiGunGu options will be dynamically populated here -->
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <label for="dongSelect" class="form-label"></label>
                                        <select id="dongSelect" name="dong" class="form-select mr-2">
                                            <option value="">동 선택</option>
                                            <!-- Dong options will be dynamically populated here -->
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="mainCategoryId">카테고리:</label>
                                        <select class="form-control" id="mainCategoryId"
                                                th:field="*{programDto.mainCategoryId}" required>
                                            <option value="">Select Category</option>
                                            <option value="1">Yoga</option>
                                            <option value="2">Prenatal/Postnatal</option>
                                            <option value="3">Exercise</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="subCategoryId">서브카테고리:</label>
                                        <select class="form-control" id="subCategoryId"
                                                th:field="*{programDto.subCategoryId}" required>
                                            <option value="">Select Subcategory</option>
                                            <!-- 서브 카테고리 옵션은 JavaScript를 통해 동적으로 채워짐 -->
                                        </select>
                                    </div>
                                    <!-- 추가된 hidden 필드 -->
                                    <input type="hidden" th:field="*{programDto.subCategoryId}"
                                           id="hiddenSubCategoryId"/>


                                </div>
                            </form>
                            <button id="findExpertsButton" class="btn btn-primary mt-3">맞는 전문가 찾기!</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 결과를 표시할 영역 추가 -->
        <div class="container mt-5">
            <div id="programs-container">
                <!-- 동적으로 프로그램 목록이 표시될 공간 -->
                <!-- /fragments/program-list.html -->
                <div th:fragment="programList">
                    <div th:each="program : ${programs}">
                        <div class="card outer-card">
                            <div class="card-body">
                                <h2 th:text="${program.title}" class="card-title"></h2>
                                <p th:text="${program.description}" class="card-description"></p>
                                <!-- 프로그램의 다른 정보도 표시할 수 있습니다 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // =============================== 주소 검색 ====================================
    $(document).ready(function () {

        $.getJSON("/instructor/address/siDo", function (data) {
            var siDoSelect = $("#siDoSelect");
            $.each(data, function (index, siDo) {
                siDoSelect.append($("<option></option>").attr("value", siDo).text(siDo));
            });
        });

        $("#siDoSelect").change(function () {
            var siDo = $(this).val();
            $("#siGunGuSelect").empty().append("<option value=''>시군구 선택</option>");
            $("#dongSelect").empty().append("<option value=''>동 선택</option>");

            if (!siDo) return;

            $.getJSON("/instructor/address/siGunGu", {siDo: siDo}, function (data) {
                var siGunGuSelect = $("#siGunGuSelect");
                $.each(data, function (index, siGunGu) {
                    siGunGuSelect.append($("<option></option>").attr("value", siGunGu).text(siGunGu));
                });
            });
        });

        $("#siGunGuSelect").change(function () {
            var siGunGu = $(this).val();
            $("#dongSelect").empty().append("<option value=''>동 선택</option>");

            if (!siGunGu) return;

            $.getJSON("/instructor/address/dong", {siGunGu: siGunGu}, function (data) {
                var dongSelect = $("#dongSelect");
                $.each(data, function (index, dong) {
                    dongSelect.append($("<option></option>").attr("value", dong).text(dong));
                });
            });
        });
        $("#findExpertsButton").click(function () {
            const siDo = $("#siDoSelect").val();
            const siGunGu = $("#siGunGuSelect").val();
            const dong = $("#dongSelect").val();
            const mainCategoryId = $("#mainCategoryId").val();
            const subCategoryId = $("#subCategoryId").val();

            $.ajax({
                url: "/main/match/search",
                type: "POST",
                data: {
                    siDo,
                    siGunGu,
                    dong,
                    mainCategoryId,
                    subCategoryId,
                },
                success: function (data) {
                    // 받은 프로그램 데이터를 화면에 표시
                    $("#programs-container").html(data);
                },
                error: function (error) {
                    console.error("Error:", error);
                }
            });

        });

    })

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('mainCategoryId').addEventListener('change', function () {
            const subCategories = {
                '1': {'Yoga': 1}, // Yoga
                '2': {'Prenatal/Postnatal Care': 2}, // Prenatal/Postnatal
                '3': {'Diet': 3, 'Strength': 4, 'Pain Management': 5} // Exercise
            };

            const category = this.value;
            const subCategorySelect = document.getElementById('subCategoryId');
            subCategorySelect.innerHTML = '<option value="">Select Subcategory</option>'; // 초기화

            if (subCategories[category]) {
                Object.keys(subCategories[category]).forEach(function (name) {
                    const id = subCategories[category][name];
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = name;
                    subCategorySelect.appendChild(option);
                });
            }
        });

        // 폼 제출 시 서브 카테고리 값을 hidden field에 설정
        document.getElementById('programForm').addEventListener('submit', function () {
            const selectedSubCategory = document.getElementById('subCategoryId').value;
            document.getElementById('hiddenSubCategoryId').value = selectedSubCategory; // hidden 필드에 서브 카테고리 ID 설정
        });
    });


</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>