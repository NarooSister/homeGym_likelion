<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Instructor Schedule</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h2 th:text="${instructorName} + '님의 스케줄'"></h2>

    <!-- 주소 등록 섹션 추가 -->
    <div class="card mb-3 mt-3">
        <div class="card-header">주소 등록</div>
        <div class="card-body">
            <form th:action="@{'/instructor/schedule/address'}" method="post">
                <label for="siDoSelect" class="form-label"></label>
                <select id="siDoSelect" name="siDo" class="form-select mr-2">
                    <option value="">시도 선택</option>
                    <!-- SiDo options will be dynamically populated here -->
                </select>
                <label for="siGunGuSelect" class="form-label"></label>
                <select id="siGunGuSelect" name="siGunGu" class="form-select mr-2">
                    <option value="">시군구 선택</option>
                    <!-- SiGunGu options will be dynamically populated here -->
                </select>
                <label for="dongSelect" class="form-label"></label>
                <select id="dongSelect" name="dong" class="form-select mr-2">
                    <option value="">동 선택</option>
                    <!-- Dong options will be dynamically populated here -->
                </select>
                <button type="submit" class="btn btn-outline-primary">주소 등록</button>
            </form>
        </div>
    </div>

    <!-- 주소 목록 섹션 추가 -->
    <div class="card mb-3">
        <div class="card-header">주소 목록</div>
        <div class="card-body">
            <table id="addressTable" class="table">
                <thead>
                <tr>
                    <th>시도</th>
                    <th>시군구</th>
                    <th>동</th>
                    <th>삭제</th>
                </tr>
                </thead>
                <tbody th:each="address : ${instructorAddresses}">
                <tr>
                    <td th:text="${address.siDo}"></td>
                    <td th:text="${address.siGunGu}"></td>
                    <td th:text="${address.dong}"></td>
                    <td>
                        <table>
                            <!-- 주소 삭제 폼 -->
                            <form th:action="@{'/instructor/schedule/address/' + ${address.id}}" method="post"
                                  onsubmit="return confirm('주소를 삭제하시겠습니까?');">
                                <input type="hidden" name="_method" value="delete"/>
                                <button type="submit" class="btn btn-outline-danger">삭제</button>
                            </form>
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- 정렬 옵션 -->
    <div class="card mb-3">
        <div class="card-header">스케줄</div>
        <div class="card-body">
            <div class="mb-3">
                <label for="orderBy" class="form-label">정렬:</label>
                <select id="orderBy" name="orderBy" class="form-select" onchange="handleOrderBySelection(this)">
                    <option value="/instructor/schedule?orderBy=week" th:selected="${orderBy == 'week'}">요일순</option>
                    <option value="/instructor/schedule?orderBy=time" th:selected="${orderBy == 'time'}">시간순</option>
                </select>
            </div>

            <table class="table">
                <thead>
                <tr>
                    <th>요일</th>
                    <th>시간</th>
                    <th>생성 시간</th>
                    <th>수정 및 삭제</th>
                </tr>
                </thead>
                <tbody th:each="scheduleDto : ${scheduleDtos}">
                <tr>
                    <form th:action="@{/instructor/schedule/{scheduleId}(scheduleId=${scheduleDto.id})}" method="post"
                          onsubmit="return confirm('프로그램을 수정하시겠습니까?');">
                        <td>
                            <!-- 요일 선택 -->
                            <select name="week" class="form-select">
                                <option value="">요일 선택</option>
                                <option th:each="week : ${T(com.example.homeGym.instructor.entity.Week).values()}"
                                        th:value="${week.name()}" th:text="${week.koreanName}"
                                        th:selected="${week.name() == scheduleDto.week}">Week slot
                                </option>
                            </select>
                        </td>
                        <td>
                            <!-- 시간 선택 -->
                            <select name="time" class="form-select">
                                <option value="">시간 선택</option>
                                <option th:each="time : ${T(com.example.homeGym.instructor.entity.Time).values()}"
                                        th:value="${time.name()}" th:text="${time.description}"
                                        th:selected="${time.name() == scheduleDto.time}">Time slot
                                </option>
                            </select>
                        </td>
                        <td th:text="${#temporals.format(scheduleDto.createAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        <td>
                            <table>
                                <!-- 스케줄 수정 폼 -->
                                <form th:action="@{'/instructor/schedule/' + ${scheduleDto.id}}" method="post"
                                      onsubmit="return confirm('스케줄을 수정하시겠습니까?');">
                                    <input type="hidden" name="_method" value="put"/>
                                    <button type="submit" class="btn btn-outline-warning mr-2">수정</button>
                                </form>
                                <!-- 스케줄 삭제 폼 -->
                                <form th:action="@{'/instructor/schedule/' + ${scheduleDto.id}}" method="post"
                                      onsubmit="return confirm('스케줄을 삭제하시겠습니까?');">
                                    <input type="hidden" name="_method" value="delete"/>
                                    <button type="submit" class="btn btn-outline-danger">삭제</button>
                                </form>
                            </table>
                        </td>
                    </form>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- 스케줄 생성 폼 -->

    <div class="card mb-3">
        <div class="card-header">새 스케줄 생성</div>
        <div class="card-body">
            <form th:action="@{'/instructor/schedule'}" method="post">
                <div class="form-group">
                    <label for="week" class="form-label">요일</label>
                    <select id="week" name="week" class="form-select" required>
                        <option value="">요일 선택</option>
                        <option th:each="week : ${T(com.example.homeGym.instructor.entity.Week).values()}"
                                th:value="${week.name()}" th:text="${week.koreanName}">Week slot
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="time" class="form-label">시간</label>
                    <select id="time" name="time" class="form-select" required>
                        <option value="">시간 선택</option>
                        <option th:each="time : ${T(com.example.homeGym.instructor.entity.Time).values()}"
                                th:value="${time.name()}" th:text="${time.description}">Time slot
                        </option>
                    </select>
                </div>
                <button type="submit" class="btn btn-outline-primary mr-1">스케줄 생성</button>
                <!-- 페이지로 돌아가는 버튼 -->
                <button type="button" class="btn btn-outline-success" onclick="goToInstructorPage()">프로필로 돌아가기</button>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap JS 및 Popper.js -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>

<script th:inline="javascript">
    // JavaScript function to handle selection of orderBy option
    function handleOrderBySelection(selectElement) {
        // Get the selected value
        var selectedValue = selectElement.value;
        // Redirect to the selected URL
        window.location.href = selectedValue;
    }

    function goToInstructorPage() {
        window.location.href = "/instructor/";
    }

    $(document).ready(function () {

        $.getJSON("address/siDo", function (data) {
            var siDoSelect = $("#siDoSelect");
            $.each(data, function (index, siDo) {
                siDoSelect.append($("<option></option>").attr("value", siDo).text(siDo));
            });
        });

        $("#siDoSelect").change(function () {
            var siDo = $(this).val();
            $("#siGunGuSelect").empty().append("<option value=''>시군구 선택</option>");
            $("#dongSelect").empty().append("<option value=''>동 선택</option>");

            if (!siDo) return;

            $.getJSON("address/siGunGu", {siDo: siDo}, function (data) {
                var siGunGuSelect = $("#siGunGuSelect");
                $.each(data, function (index, siGunGu) {
                    siGunGuSelect.append($("<option></option>").attr("value", siGunGu).text(siGunGu));
                });
            });
        });

        $("#siGunGuSelect").change(function () {
            var siGunGu = $(this).val();
            $("#dongSelect").empty().append("<option value=''>동 선택</option>");

            if (!siGunGu) return;

            $.getJSON("address/dong", {siGunGu: siGunGu}, function (data) {
                var dongSelect = $("#dongSelect");
                $.each(data, function (index, dong) {
                    dongSelect.append($("<option></option>").attr("value", dong).text(dong));
                });
            });
        });

    });


</script>

